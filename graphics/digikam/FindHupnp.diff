--- digikam-3.2.0/extra/kipi-plugins/cmake/modules/FindHupnp.cmake	2013-05-13 09:51:08.000000000 +0200
+++ digikam-3.2.0/extra/kipi-plugins/cmake/modules/FindHupnp.cmake.new	2013-06-02 15:32:06.771699358 +0200
@@ -18,20 +18,29 @@
           /usr/include/HUpnpAv/
          )
 
+if( HUPNP_INCLUDE_DIR AND EXISTS "${HUPNP_INCLUDE_DIR}/HUpnpCore/public/hupnpinfo.h" )
+    file( STRINGS "${HUPNP_INCLUDE_DIR}/HUpnpCore/public/hupnpinfo.h" HUPNP_INFO_H REGEX "^#define HUPNP_CORE_.*_VERSION .*$" )
+    string( REGEX REPLACE ".*HUPNP_CORE_MAJOR_VERSION ([0-9]+).*" "\\1" HUPNP_VERSION_MAJOR "${HUPNP_INFO_H}" )
+    string( REGEX REPLACE ".*HUPNP_CORE_MINOR_VERSION ([0-9]+).*" "\\1" HUPNP_VERSION_MINOR "${HUPNP_INFO_H}" )
+    string( REGEX REPLACE ".*HUPNP_CORE_PATCH_VERSION ([0-9]+).*" "\\1" HUPNP_VERSION_PATCH "${HUPNP_INFO_H}" )
+
+    set( HUPNP_VERSION_STRING "${HUPNP_VERSION_MAJOR}.${HUPNP_VERSION_MINOR}.${HUPNP_VERSION_PATCH}" )
+endif()
+
 FIND_LIBRARY(HUPNP_LIBS   HUpnp   PATHS ${PC_HUPNP_LIBRARY})
 FIND_LIBRARY(HUPNPAV_LIBS HUpnpAv PATHS ${PC_HUPNP_LIBRARY})
 
-IF(HUPNP_INCLUDE_DIR AND HUPNP_LIBS)
+IF(HUPNP_INCLUDE_DIR AND HUPNP_LIBS AND NOT HUPNP_VERSION_STRING VERSION_LESS 2.0.0)
     SET(HUPNP_FOUND TRUE)
     MESSAGE(STATUS "Found HUpnpCore : ${HUPNP_INCLUDE_DIR} ${HUPNP_LIBS}")
-ELSE(HUPNP_INCLUDE_DIR AND HUPNP_LIBS)
+ELSE(HUPNP_INCLUDE_DIR AND HUPNP_LIBS AND NOT HUPNP_VERSION_STRING VERSION_LESS 2.0.0)
     SET(HUPNP_FOUND FALSE)
     IF(HUPNP_FIND_REQUIRED)
         MESSAGE(FATAL_ERROR "Could NOT find required package HUpnpCore: <http://herqq.org>")
     ELSE(HUPNP_FIND_REQUIRED)
         MESSAGE(STATUS "Could NOT find required package HUpnpCore: <http://herqq.org>")
     ENDIF(HUPNP_FIND_REQUIRED)
-ENDIF(HUPNP_INCLUDE_DIR AND HUPNP_LIBS)
+ENDIF(HUPNP_INCLUDE_DIR AND HUPNP_LIBS AND NOT HUPNP_VERSION_STRING VERSION_LESS 2.0.0)
 
 IF(HUPNPAV_INCLUDE_DIR AND HUPNPAV_LIBS)
     SET(HUPNPAV_FOUND TRUE)
